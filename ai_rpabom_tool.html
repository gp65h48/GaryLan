<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPABOM 詢價智能工具</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Vanilla -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- SheetJS (XLSX Style Bundle) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .sticky-header th { position: sticky; top: 0; background: #f8fafc; z-index: 10; border-bottom: 2px solid #e2e8f0; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // A2* 供應商清單
        const VENDOR_LIST_A2 = [
            "3M", "ABB", "ALL BEST", "AMPHENOL", "APP", "BERG", "BINDER", "BURNDY", 
            "CINCH", "CODAX", "CONEC", "CONINVERS", "CONXALL", "DDK", "DELPHI", "DEUTSCH", 
            "ELCO", "ELPRESS", "FANUC", "FCI", "FISCHER", "FOXCONN", "FUJITSU", "HARTING", 
            "HITACHI", "HONDA", "HOSIDEN", "HRS", "HUMMEL", "HYPERTRONICS", "I-PEX", "ITT", 
            "JAE", "JAM", "JST", "KEL", "KLAUKE", "KYCON", "LEMO", "LEOCO", "MOLEX", "MPT", 
            "MULTI-CONTACT", "NEUTRIK", "ODU", "PANASONIC", "PANDUIT", "PHOENIX", "POSITRONIC", 
            "RADIALL", "SAMTEC", "SMK", "SOURIAU", "STEWART", "SUMITOMO", "T&B", "TE", "TRW", 
            "WAGO", "WEIDMULLER", "WIELAND", "YAZAKI", "YEONHO", "YOKOWO"
        ];

        const TERM_TYPES_A2 = [
            "BNC端子", "DB端子", "DIN端子", "耳扒端子 (EAR TERM.)", "旗型端子 (FLAG TERM.)", 
            "HD端子", "MD端子", "針型端子 (PIN TERM.)", "R型端子 (RING TONGUE TERM.)", 
            "直型端子 (TAB TERM.)", "Y型/鏟型端子 (SPADE TONGUE TERM.)"
        ];

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const iconName = name.replace(/([A-Z])/g, "-$1").toLowerCase().replace(/^-/, "");
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', iconName);
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons({
                        attrs: { width: size, height: size, class: className },
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        const App = () => {
            const [bomData, setBomData] = useState([]);
            const [fileName, setFileName] = useState('');
            const [results, setResults] = useState(null);
            const [currentStep, setCurrentStep] = useState('upload');
            const [needsSpecItems, setNeedsSpecItems] = useState([]);
            const [manualInterpretations, setManualInterpretations] = useState({}); 
            const [bulkInput, setBulkInput] = useState('');
            const [copySuccess, setCopySuccess] = useState(false);

            const preprocessData = (data) => {
                let lastMaterPN = '';
                return data.map(row => {
                    Object.keys(row).forEach(key => {
                        if (typeof row[key] === 'string') {
                            row[key] = row[key].replace(/[\r\n]+/g, ' ').trim();
                        }
                    });
                    const current = String(row['MaterPN'] || '').trim();
                    if (current !== '') lastMaterPN = current;
                    else {
                        row['_isMerged'] = true;
                        row['MaterPN'] = lastMaterPN;
                    }
                    return row;
                });
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setFileName(file.name);
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    const ws = wb.Sheets[wb.SheetNames[0]];
                    let data = XLSX.utils.sheet_to_json(ws, { defval: '' });
                    setBomData(preprocessData(data));
                };
                reader.readAsBinaryString(file);
            };

            const checkIsA9 = (row, nextRow) => {
                if (!nextRow) return false;
                const curLvl = String(row['Level'] || '').trim();
                const nextLvl = String(nextRow['Level'] || '').trim();
                return curLvl && nextLvl && nextLvl.startsWith(curLvl + ".");
            };

            const getSpecialLabel = (row) => {
                const pos = String(row['POS'] || '').trim();
                const desc = String(row['DESCRIPTION'] || '').toUpperCase();
                if (pos === '0000') return "圖面";
                if (/(SPEC|PROCEDURE|DOCUMENT|DOC|文件|程序|手冊|說明書)/.test(desc)) return "文件";
                if (/(FIRMWARE|SOFTWARE|SW|FW|韌體|軟體)/.test(desc)) return "韌體";
                return null;
            };

            const startAnalysis = () => {
                const cleanBOM = bomData.filter(row => {
                    const pos = String(row['POS'] || '');
                    const lvl = String(row['Level'] || '').toLowerCase();
                    return !pos.startsWith('70') && !lvl.includes('level') && lvl !== '';
                });

                const needs = cleanBOM.filter((row, idx) => {
                    const comp = String(row['COMPONENT'] || '').trim();
                    const desc = String(row['DESCRIPTION'] || '').trim();
                    const snpPn = String(row['信邦料號'] || '').trim();
                    const nextRow = cleanBOM[idx + 1];

                    if (checkIsA9(row, nextRow)) {
                        row['_autoLabel'] = 'A9*';
                        return false;
                    }
                    const special = getSpecialLabel(row);
                    if (special) {
                        row['_autoLabel'] = special;
                        return false;
                    }
                    return (comp !== '' || desc !== '') && snpPn === '';
                });

                setNeedsSpecItems(needs);
                setCurrentStep('review');
            };

            const promptContent = useMemo(() => {
                const compList = needsSpecItems.map(item => {
                    const c = String(item.COMPONENT).trim();
                    const d = String(item.DESCRIPTION).trim();
                    return c ? c : `DESC_${d}`;
                }).filter((v, i, a) => a.indexOf(v) === i).join('\n');

                return `你現在是一位專業的電子業採購與物料專家。請分析文件並針對以下出現的「元件料號」提供精確的規格解讀與分類建議：

【待查詢清單】
${compList}

【任務要求】
1. 簡短敘述：繁體中文提供約 20-30 字敘述該零件之功能與關鍵規格。
2. 分類代碼：優先權：若屬於 A2* 廠商的連接器或端子類型，請改優先分類為 A2*。
            優先權：若料號開頭為714-XXX優先視為機構件A4*或A5*，再依材質區分。
            優先權：若料號開頭為681-XXX優先視為線材A1*
   * 文件: 描述包含 SPEC, PROCEDURE, DOCUMENT, DOC, 文件, 程序書, 說明書, 手冊。
   * 韌體: 描述包含 FIRMWARE, SOFTWARE, SW, FW, 韌體, 軟體。
   * A1*: 電線 / 電纜 (Wire / Cable)。此項指的是電子線，不包含塑膠軟管或金屬鋼絲。
   * A2*: 端子、觸點 (含 ${TERM_TYPES_A2.join(', ')})，以及特定廠商：${VENDOR_LIST_A2.join(', ')}。
   * A3*: 一般連接器 (非 A2* 廠商)、連接器配件。
   * A4*: 金屬機構件/螺絲/五金 
   * A5*: 塑膠機構件/束帶/非金屬機構件/熱縮套管
   * A6*: 電子零件/PCBA/PCB/複雜電機
   * A0*: 原物料/包裝材料/消耗品

【輸出格式要求】
嚴格遵守以下格式，且每一筆資料佔一行（若資訊無法判別請標明 NA）：
[料號或DESC_ID] | [簡短敘述] | [分類代碼] | [供應商]`;
            }, [needsSpecItems]);

            const copyPrompt = () => {
                const textArea = document.createElement("textarea");
                textArea.value = promptContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setCopySuccess(true);
                setTimeout(() => setCopySuccess(false), 2000);
            };

            // 深度優化後的匹配解析器：支援中括號與隨意換行
            const handleParse = () => {
                const newMap = { ...manualInterpretations };
                let matchCount = 0;
                
                needsSpecItems.forEach((item, idx) => {
                    const comp = String(item.COMPONENT).trim();
                    const desc = String(item.DESCRIPTION).trim();
                    const searchId = comp ? comp : `DESC_${desc}`;
                    const escapedId = searchId.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    
                    // 優化正則：
                    // 1. (?:\[)? : 選擇性匹配左括號
                    // 2. (?:\])? : 選擇性匹配右括號
                    // 3. [^|]+? : 匹配分隔符中間的文字
                    const regex = new RegExp(`(?:[^\\w-]|^)(?:\\[)?${escapedId}(?:\\])?\\s*\\|\\s*([^|\\n]+)\\s*\\|\\s*([^|\\n]+)(?:\\s*\\|\\s*([^|\\n\\[\\]]+))?`, 'mi');
                    
                    const match = bulkInput.match(regex);
                    if (match) {
                        matchCount++;
                        let cat = match[2].trim();
                        // 確保代碼含有星號
                        if (!['文件', '韌體', 'NA'].includes(cat) && !cat.includes('*')) cat += '*';
                        newMap[idx] = { 
                            summary: match[1].trim(), 
                            category: cat, 
                            vendor: match[3] ? match[3].trim() : "NA" 
                        };
                    }
                });
                
                setManualInterpretations(newMap);
                setBulkInput('');
                if(matchCount === 0) {
                    alert("偵測失敗！請檢查貼入的格式是否正確，必須包含：\n[料號] | [敘述] | [代碼]");
                } else {
                    console.log(`成功匹配 ${matchCount} 筆資料`);
                }
            };

            const finalize = () => {
                const cleanBOM = bomData.filter(row => !String(row['Level']).toLowerCase().includes('level') && !String(row['POS']).startsWith('70'));
                const page3MaterPNs = new Set(cleanBOM.map(r => String(r['MaterPN'] || '').trim()).filter(v => v !== ''));

                const final = cleanBOM.map((row, idx) => {
                    const newRow = { ...row };
                    const comp = String(newRow['COMPONENT']).trim();
                    const desc = String(newRow['DESCRIPTION']).trim();
                    const price = String(newRow['單價'] || '').trim();
                    const snpPn = String(newRow['信邦料號'] || '').trim();
                    
                    if (comp !== '' || desc !== '') {
                        const target = comp !== '' ? comp : desc;
                        const prevComp = cleanBOM[idx - 1] ? (String(cleanBOM[idx - 1]['COMPONENT']).trim() || String(cleanBOM[idx - 1]['DESCRIPTION']).trim()) : null;
                        const nextComp = cleanBOM[idx + 1] ? (String(cleanBOM[idx + 1]['COMPONENT']).trim() || String(cleanBOM[idx + 1]['DESCRIPTION']).trim()) : null;
                        newRow._remark = (target === prevComp || target === nextComp) ? "有重複項" : "";
                    }

                    const needsIdx = needsSpecItems.findIndex(n => n.流水碼 === row.流水碼);
                    const manual = manualInterpretations[needsIdx];
                    const isParentInPage3 = comp !== "" && page3MaterPNs.has(comp);

                    let baseCat = "";
                    if (manual) {
                        baseCat = manual.category !== 'NA' ? manual.category : 'A*';
                        newRow['_aiSummary'] = manual.summary;
                        newRow['_vendor'] = manual.vendor;
                    } else if (newRow._autoLabel) {
                        baseCat = newRow._autoLabel;
                    } else {
                        baseCat = snpPn;
                    }

                    if (isParentInPage3) {
                        const isSpecialLabel = ['圖面', '文件', '韌體'].includes(baseCat);
                        const alreadyA9 = baseCat.startsWith('A9');

                        if (baseCat && !alreadyA9 && !isSpecialLabel) {
                            newRow['信邦料號'] = `${baseCat}或A9*`;
                        } else {
                            newRow['信邦料號'] = baseCat || "A9*";
                        }
                    } else {
                        newRow['信邦料號'] = baseCat || "A*";
                    }

                    const finalPn = String(newRow['信邦料號'] || '').trim();
                    newRow._isPriceMissing = (finalPn !== '') && (!price || price === '0' || price === '0.0');

                    return newRow;
                });

                setResults({
                    original: bomData,
                    excluded70xx: bomData.filter(r => String(r['POS']).startsWith('70')),
                    full: final,
                    priceMissing: final.filter(r => r._isPriceMissing)
                });
                setCurrentStep('results');
            };

            const download = () => {
                const wb = XLSX.utils.book_new();
                const level1Item = results.full.find(r => String(r.Level).trim() === "1");
                const mainComponentName = (level1Item?.COMPONENT || "未知料號").trim();
                const safeFileName = mainComponentName.replace(/[\\\/:*?"<>|]/g, "");

                const addSheet = (data, name, highlightPrice = false) => {
                    const exportData = data.map(r => {
                        const cleanRow = {};
                        Object.keys(r).forEach(k => {
                            if (!k.startsWith('_')) cleanRow[k] = r[k];
                        });
                        return {
                            ...cleanRow,
                            "AI 規格摘要": r._aiSummary || "",
                            "供應商來源": r._vendor || "",
                            "備註": r._remark || ""
                        };
                    });
                    const ws = XLSX.utils.json_to_sheet(exportData);
                    const range = XLSX.utils.decode_range(ws['!ref']);
                    for (let r = 1; r <= range.e.r; r++) {
                        for (let c = range.s.c; c <= range.e.c; c++) {
                            const addr = XLSX.utils.encode_cell({ r, c });
                            if (!ws[addr]) continue;
                            if (!ws[addr].s) ws[addr].s = {};
                            ws[addr].s.alignment = { horizontal: 'center', vertical: 'center', wrapText: true };
                            if (highlightPrice && data[r-1]?._isPriceMissing && c === 15) {
                                ws[addr].s.fill = { fgColor: { rgb: "87CEEB" } };
                            }
                        }
                    }
                    XLSX.utils.book_append_sheet(wb, ws, name);
                };

                addSheet(results.original, "1.RPABOM");
                addSheet(results.excluded70xx, "2.70XX文件");
                addSheet(results.full, "3.RPABOM(分類完成)", true);
                addSheet(results.priceMissing, "4.RPABOM(需詢價)");

                XLSX.writeFile(wb, `${safeFileName}詢價分析報告.xlsx`);
            };

            return (
                <div className="max-w-7xl mx-auto px-4 py-8">
                    {/* Header */}
                    <div className="bg-white rounded-[2rem] shadow-sm p-6 mb-8 border border-slate-200 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-indigo-600 rounded-2xl shadow-lg">
                                <Icon name="BrainCircuit" className="text-white" />
                            </div>
                            <div>
                                <h1 className="text-2xl font-black text-slate-900 tracking-tight">RPABOM 詢價智能工具</h1>
                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">
                                    版本A01 | 製作者：Gary Lan (Gemini) 2026/02/03
                                </p>
                            </div>
                        </div>
                        {results && (
                            <button onClick={download} className="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-xl font-bold transition-all flex items-center gap-2 shadow-lg active:scale-95">
                                <Icon name="Download" /> 匯出詢價報告
                            </button>
                        )}
                    </div>

                    {currentStep === 'upload' && (
                        <div className="bg-white rounded-[2.5rem] p-16 shadow-xl border border-slate-200 text-center max-w-xl mx-auto animate-in fade-in zoom-in duration-500">
                            <Icon name="UploadCloud" size={60} className="mx-auto mb-6 text-indigo-100" />
                            <h2 className="text-2xl font-bold mb-4 text-slate-800 tracking-tight">載入 BOM 並分析項目</h2>
                            <label className="relative block group cursor-pointer mb-8">
                                <input type="file" onChange={handleFileUpload} className="absolute inset-0 opacity-0 z-20" />
                                <div className="bg-slate-50 border-2 border-dashed border-slate-200 rounded-3xl py-12 flex flex-col items-center gap-4 group-hover:border-indigo-400 group-hover:bg-indigo-50 transition-all">
                                    <Icon name="FileSpreadsheet" className="text-slate-300" size={40} />
                                    <span className="text-sm font-bold text-slate-600 underline decoration-slate-200">{fileName || "點擊選取檔案"}</span>
                                </div>
                            </label>
                            {bomData.length > 0 && (
                                <button onClick={startAnalysis} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                                    <Icon name="ArrowRight" /> 執行結構分析
                                </button>
                            )}
                        </div>
                    )}

                    {currentStep === 'review' && (
                        <div className="space-y-6 animate-in slide-in-from-right duration-500">
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="bg-indigo-900 rounded-[2rem] p-8 text-white shadow-2xl relative overflow-hidden">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-bold flex items-center gap-2"><Icon name="Terminal" className="text-indigo-400" /> 1. 複製 NotebookLM 提示詞</h3>
                                        <a href="https://notebooklm.google.com/" target="_blank" rel="noopener noreferrer" className="text-[10px] bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full font-bold transition-all flex items-center gap-1">
                                            [前往 NotebookLM 主頁] <Icon name="ExternalLink" size={10} />
                                        </a>
                                    </div>
                                    <div className="bg-black/20 rounded-2xl p-4 font-mono text-[10px] text-indigo-100 h-48 overflow-y-auto mb-6 whitespace-pre-wrap custom-scrollbar">{promptContent}</div>
                                    <button onClick={copyPrompt} className={`w-full py-4 rounded-2xl font-black transition-all flex items-center justify-center gap-2 shadow-lg ${copySuccess ? 'bg-emerald-500' : 'bg-white text-indigo-900 hover:bg-indigo-50'}`}>
                                        {copySuccess ? <Icon name="Check" /> : <Icon name="Copy" />} {copySuccess ? '已複製到剪貼簿' : '點擊複製'}
                                    </button>
                                </div>
                                <div className="bg-white rounded-[2rem] p-8 border border-slate-200 shadow-sm">
                                    <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-slate-800"><Icon name="ClipboardPaste" className="text-indigo-600" /> 2. 回貼分析解讀內容</h3>
                                    <textarea value={bulkInput} onChange={(e) => setBulkInput(e.target.value)} placeholder="[料號] | [敘述] | [代碼] | [供應商]" className="w-full h-48 bg-slate-50 border border-slate-100 rounded-2xl p-4 text-xs font-mono mb-4 focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                    <div className="flex gap-4">
                                        <button onClick={handleParse} className="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-md">匹配解析</button>
                                        <button onClick={finalize} className="flex-1 bg-emerald-600 text-white py-3 rounded-xl font-bold hover:bg-emerald-700 shadow-lg">產出最終分析</button>
                                    </div>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                                {needsSpecItems.map((item, idx) => {
                                    const manual = manualInterpretations[idx];
                                    return (
                                        <div key={idx} className={`bg-white p-6 rounded-[2rem] border-2 transition-all ${manual ? 'border-emerald-200 bg-emerald-50/20' : 'border-slate-100 opacity-80'}`}>
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-[10px] font-black text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full uppercase">POS {item.POS}</span>
                                                {manual && <Icon name="CheckCircle2" size={16} className="text-emerald-500" />}
                                            </div>
                                            <h4 className="font-bold text-slate-900 truncate tracking-tight">{item.COMPONENT || "(無料號)"}</h4>
                                            <p className="text-slate-400 italic text-[11px] mb-3 line-clamp-1">"{item.DESCRIPTION}"</p>
                                            {manual && (
                                                <div className="text-[10px] p-2 bg-white rounded-xl text-slate-600 italic border border-emerald-50">
                                                    {manual.summary}
                                                    <div className="mt-1 font-bold text-emerald-700 uppercase">代碼: {manual.category} | 供應商: {manual.vendor}</div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {results && currentStep === 'results' && (
                        <div className="animate-in fade-in duration-700 space-y-6">
                            <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                                <StatBox title="70XX 排除" count={results.excluded70xx.length} />
                                <StatBox title="A9* 母階" count={results.full.filter(r=>r['信邦料號'].includes('A9*')).length} color="text-indigo-600" />
                                <StatBox title="需標色項" count={results.full.filter(r=>r._isPriceMissing).length} color="text-red-500" />
                                <StatBox title="詢價清單" count={results.priceMissing.length} highlight />
                            </div>

                            <div className="bg-white rounded-[2rem] shadow-sm border border-slate-200 p-8 overflow-hidden">
                                <h3 className="text-lg font-black mb-6 flex items-center gap-2"><Icon name="Layers" className="text-indigo-500" /> 分析預覽 (3.分類完成)</h3>
                                <div className="max-h-[600px] overflow-y-auto overflow-x-auto rounded-2xl border border-slate-100 custom-scrollbar">
                                    <table className="w-full text-[11px] text-left">
                                        <thead className="sticky-header">
                                            <tr className="bg-slate-50 text-slate-400 font-black uppercase tracking-wider">
                                                <th className="px-6 py-4">MaterPN</th>
                                                <th className="px-6 py-4">信邦料號</th>
                                                <th className="px-6 py-4">供應商</th>
                                                <th className="px-6 py-4">COMPONENT</th>
                                                <th className="px-6 py-4 text-red-500">備註 (重複項)</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {results.full.map((row, i) => (
                                                <tr key={i} className={`hover:bg-indigo-50/20 transition-colors ${row._isMerged ? 'bg-slate-50/5' : ''}`}>
                                                    <td className={`px-6 py-4 font-bold border-r border-slate-50 ${row._isMerged ? 'text-transparent' : 'text-slate-400'}`}>{row['MaterPN']}</td>
                                                    <td className={`px-6 py-4 font-mono font-bold ${row._isPriceMissing ? 'bg-sky-100 text-indigo-700 shadow-inner' : 'text-slate-900'}`}>{row['信邦料號'] || '-'}</td>
                                                    <td className="px-6 py-4 font-medium text-slate-600 uppercase tracking-tight">{row['_vendor'] || '-'}</td>
                                                    <td className="px-6 py-4 font-medium text-slate-700">{row['COMPONENT']}</td>
                                                    <td className="px-6 py-4 font-black text-red-600 bg-red-50/10 whitespace-nowrap">
                                                        {row._remark && <span className="flex items-center gap-1"><Icon name="AlertTriangle" size={12} /> {row._remark}</span>}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const StatBox = ({ title, count, color="text-slate-900", highlight=false }) => (
            <div className={`p-6 rounded-[2rem] border border-slate-200 shadow-sm transition-all ${highlight ? 'bg-indigo-600 text-white' : 'bg-white shadow-indigo-100'}`}>
                <div className={`text-3xl font-black mb-1 ${highlight ? 'text-white' : color}`}>{count}</div>
                <h4 className={`text-[10px] font-bold uppercase tracking-widest ${highlight ? 'text-indigo-100' : 'text-slate-400'}`}>{title}</h4>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
