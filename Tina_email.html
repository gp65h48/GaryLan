<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f1f5f9; font-family: "Microsoft JhengHei", "PingFang TC", sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 10px; }
    .card { background: white; border-radius: 2rem; box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.15); width: 100%; max-width: 90rem; height: 92vh; display: flex; overflow: hidden; }
    .input-field { width: 100%; margin-top: 0.2rem; border: 2px solid #f1f5f9; border-radius: 0.75rem; padding: 0.6rem 1rem; font-size: 0.9rem; outline: none; transition: all 0.2s; background-color: #f8fafc; }
    .input-field:focus { border-color: #0078d4; background-color: white; box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1); }
    .label-title { display: block; font-size: 0.85rem; font-weight: 800; color: #475569; margin-left: 0.25rem; }
    .subject-preview-box { background-color: #f0f7ff; border: 2px solid #0078d4; color: #0078d4; border-radius: 0.75rem; padding: 0.75rem 1rem; font-weight: 900; font-size: 1.1rem; min-height: 3rem; display: flex; align-items: center; }
    .pane-padding { padding: 2rem; }
    .sheet-btn { display: flex; align-items: center; justify-content: center; background-color: #107c10; color: white; padding: 0.8rem; border-radius: 0.75rem; font-weight: 800; transition: all 0.3s; text-decoration: none; border: 2px solid #0e630e; margin-top: 0.5rem; }
    .footer-brand { text-align: center; color: #94a3b8; font-size: 0.75rem; margin-top: 1rem; font-weight: bold; letter-spacing: 0.1rem; }
    
    /* æ¨¡æ“¬ç”¨çš„ Modal æ¨£å¼ */
    #mockModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 50; }
    .modal-content { background: white; padding: 2rem; border-radius: 1rem; max-width: 500px; width: 90%; }
  </style>
</head>
<body>
  <div class="card flex-col lg:flex-row">
    <!-- å·¦å´é‚Šæ¬„ -->
    <div class="w-full lg:w-[25%] bg-slate-50 pane-padding border-r border-gray-100 flex flex-col justify-between">
      <div class="space-y-4">
        <div>
          <label class="label-title text-blue-700 font-bold">å¯„ä»¶è€… <span class="text-red-500">*</span></label>
          <select id="fromUser" required class="input-field font-bold text-gray-700">
            <option value="">è«‹é¸æ“‡å§“å...</option>
            <option value="Tom">Tom</option>
            <option value="Allen">Allen</option>
            <option value="Max">Max</option>
            <option value="Tina">Tina</option>
            <option value="Luca">Luca</option>
            <option value="Humbert">Humbert</option>
            <option value="Gary">Gary</option>
            <option value="William">William</option>
          </select>
        </div>
        <div>
          <label class="label-title text-blue-700 font-bold">æ”¶ä»¶è€… (To)</label>
          <textarea id="mainReceiver" class="input-field bg-white h-24 resize-none" readonly placeholder="é¸æ“‡ä»»å‹™å¾Œè‡ªå‹•å¸¶å…¥"></textarea>
        </div>
        <div>
          <label class="label-title text-blue-700 font-bold">å‰¯æœ¬ (Cc)</label>
          <textarea id="receiver" class="input-field bg-white h-40 resize-none" readonly placeholder="é¸æ“‡ä»»å‹™å¾Œè‡ªå‹•å¸¶å…¥"></textarea>
        </div>
        <div class="pt-4 border-t border-slate-200">
          <label class="label-title text-green-700 font-bold mb-1">ä»»å‹™ç®¡ç†</label>
          <div class="sheet-btn cursor-pointer" onclick="alert('é€™å°‡é–‹å•Ÿ Google è©¦ç®—è¡¨é€£çµ')">é–‹å•Ÿç´€éŒ„è©¦ç®—è¡¨</div>
        </div>
      </div>
      <div class="footer-brand">TINACHEN Â®</div>
    </div>

    <!-- å³å´ä¸»å…§å®¹ -->
    <div class="w-full lg:w-[75%] pane-padding flex flex-col justify-between overflow-y-auto">
      <div>
        <h2 class="text-3xl font-black text-gray-800 mb-6">SINBON ä»»å‹™åŠ©æ‰‹ <span class="text-sm font-normal text-blue-500">(æ¨¡æ“¬é‹è¡Œä¸­)</span></h2>
        <form id="appForm" class="space-y-6" autocomplete="off">
          <div>
            <label class="label-title font-bold text-gray-700">å¯„ä»¶ä»»å‹™ <span class="text-red-500">*</span></label>
            <select id="purpose" required class="input-field font-black text-blue-700 text-lg" onchange="handlePurposeChange()">
              <option value="">è«‹é¸æ“‡ä»»å‹™...</option>
              <option value="è«‹å ±åƒ¹">ğŸ’° è«‹å ±åƒ¹</option>
              <option value="å»ºç³»çµ±">âš™ï¸ å»ºç³»çµ±</option>
              <option value="æ¨™æº–æˆæœ¬å»ºåˆ¶">ğŸ“ˆ æ¨™æº–æˆæœ¬å»ºåˆ¶</option>
              <option value="ä¸€å…ƒæˆæœ¬å»ºåˆ¶">ğŸ’µ ä¸€å…ƒæˆæœ¬å»ºåˆ¶</option>
              <option value="æ–‡ä»¶å›æ”¶">ğŸ“„ æ–‡ä»¶å›æ”¶</option>
            </select>
          </div>

          <div id="subject-preview-container" class="hidden animate-pulse">
            <label class="label-title font-bold text-gray-700">è‡ªå‹•ç”Ÿæˆä¸»æ—¨é è¦½</label>
            <div id="subjectPreview" class="subject-preview-box">å°šæœªè¼¸å…¥å®Œæ•´è³‡è¨Š...</div>
          </div>

          <div id="single-area" class="space-y-4 pt-4 border-t border-slate-100">
            <div id="dynamic-fields" class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div id="field1-container" class="hidden">
                 <label class="label-title" id="label-field1"></label>
                 <select id="field1" class="input-field" onchange="updateSubjectPreview()">
                   <option value="">è«‹é¸æ“‡å®¢æˆ¶ä»£ç¢¼...</option>
                   <option value="LMM - Cable1738-2">LMM - Cable1738-2</option>
                   <option value="Lam ResearchB00072">Lam ResearchB00072</option>
                   <option value="TALUS1580">TALUS1580</option>
                   <option value="TEXON KR1251">TEXON KR1251</option>
                 </select>
               </div>
               <div id="field2-container" class="hidden">
                 <label class="label-title" id="label-field2"></label>
                 <input type="text" id="field2" class="input-field" placeholder="è«‹è¼¸å…¥æ–™è™Ÿ" oninput="updateSubjectPreview()">
               </div>
               <div id="cost-date-container" class="hidden">
                 <label class="label-title font-bold text-blue-600" id="label-cost-date">æ—¥æœŸ</label>
                 <input type="date" id="costReqDate" class="input-field" onchange="updateSubjectPreview()">
               </div>
               <div id="bom-date-container" class="hidden">
                 <label class="label-title font-bold text-blue-600">åœ–BOMç”¢å‡ºé è¨ˆå®Œæˆæ—¥</label>
                 <input type="date" id="bomReqDate" class="input-field">
               </div>
               <div id="product-type-container" class="hidden">
                 <label class="label-title font-bold text-purple-700">ç”¢å“é¡å‹ <span class="text-red-500">*</span></label>
                 <input type="text" id="productType" class="input-field" placeholder="ä¾‹å¦‚ï¼šCable" oninput="updateSubjectPreview()">
               </div>
               <div id="field3-container" class="col-span-1 md:col-span-2 hidden">
                 <label class="label-title" id="label-field3"></label>
                 <input type="text" id="field3" class="input-field" placeholder="è«‹è¼¸å…¥ä¼ºæœå™¨è·¯å¾‘">
               </div>
            </div>
            <div id="note-area" class="hidden pt-2">
              <label class="label-title font-bold text-gray-700">å‚™è¨» (Note)</label>
              <textarea id="note" class="input-field" style="height: 60px;"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="mt-4">
        <button type="submit" form="appForm" class="w-full bg-[#0078d4] text-white font-black py-5 rounded-xl text-2xl shadow-xl hover:bg-blue-800 transition-all active:scale-95">ğŸš€ åŒæ­¥ä¸¦å•Ÿå‹• Outlook</button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ“¬æˆåŠŸ Modal -->
  <div id="mockModal">
    <div class="modal-content shadow-2xl border-2 border-blue-500">
      <h3 class="text-xl font-bold text-blue-700 mb-4">âœ¨ æ¨¡æ“¬åŒæ­¥å®Œæˆ</h3>
      <div class="space-y-2 text-sm text-gray-600">
        <p><strong>[å¾Œç«¯å‹•ä½œ]</strong> å·²æ¨¡æ“¬èª¿ç”¨ <code>google.script.run</code> å¯«å…¥è©¦ç®—è¡¨ã€‚</p>
        <p><strong>[å‰ç«¯å‹•ä½œ]</strong> å³å°‡é–‹å•Ÿ Outlook (mailto)ã€‚</p>
        <hr class="my-3">
        <p class="font-bold text-gray-800">ç”¢ç”Ÿçš„éƒµä»¶é è¦½ï¼š</p>
        <div id="mailSummary" class="bg-gray-50 p-3 rounded border text-xs overflow-auto max-h-40 whitespace-pre-wrap"></div>
      </div>
      <button onclick="closeModal()" class="mt-6 w-full bg-blue-600 text-white py-2 rounded-lg font-bold">é—œé–‰ä¸¦è¿”å›</button>
    </div>
  </div>

  <script>
    const appLink = "https://script.google.com/macros/s/.../exec";
    const commonCc = "AndyLai@sinbon.com;KevinLo@sinbon.com;JasonShih@sinbon.com;AllenHuang@sinbon.com;JuneYang@sinbon.com;MaxYen@sinbon.com;GaryLan@sinbon.com;HumbertHsu@sinbon.com;TomHsiao@sinbon.com;LucaChen@sinbon.com;TinaChen01@sinbon.com";

    const config = {
      "è«‹å ±åƒ¹": { to: "LucyChung@sinbon.com;CherryKo@sinbon.com;BellaChiu@sinbon.com", cc: commonCc, tag: "<è«‹å ±åƒ¹>", fields: ["å®¢æˆ¶ä»£ç¢¼", "å®¢æˆ¶æ–™è™Ÿ", "è³‡æ–™è·¯å¾‘"] },
      "å»ºç³»çµ±": { to: "LucyChung@sinbon.com;CherryKo@sinbon.com;BellaChiu@sinbon.com;ErinHo@sinbon.com", cc: commonCc, tag: "<å»ºç³»çµ±>", fields: ["å®¢æˆ¶ä»£ç¢¼", "ä¿¡é‚¦æ–™è™Ÿ", "è³‡æ–™è·¯å¾‘"] },
      "æ¨™æº–æˆæœ¬å»ºåˆ¶": { to: "LucyChung@sinbon.com;CherryKo@sinbon.com;BellaChiu@sinbon.com;ErinHo@sinbon.com;KyraHuang@sinbon.com", cc: commonCc, tag: "<ç¢ºèªæ–™æ³ã€å»ºç«‹æ¨™æº–æˆæœ¬ã€åœ–BOMç”¢å‡º>", fields: ["å®¢æˆ¶ä»£ç¢¼", "ä¿¡é‚¦æ–™è™Ÿ", "è³‡æ–™è·¯å¾‘"] },
      "ä¸€å…ƒæˆæœ¬å»ºåˆ¶": { to: "LucyChung@sinbon.com;CherryKo@sinbon.com;BellaChiu@sinbon.com;ErinHo@sinbon.com;KyraHuang@sinbon.com", cc: commonCc, tag: "<ç¢ºèªæ–™æ³ã€å»ºç«‹ä¸€å…ƒæˆæœ¬ã€åœ–BOMç”¢å‡º>", fields: ["å®¢æˆ¶ä»£ç¢¼", "ä¿¡é‚¦æ–™è™Ÿ", "è³‡æ–™è·¯å¾‘"] },
      "æ–‡ä»¶å›æ”¶": { to: "RayChung@sinbon.com;ErinHo@sinbon.com", cc: commonCc, tag: "<æ–‡ä»¶å›æ”¶>", fields: ["", "ä¿¡é‚¦æ–™è™Ÿ"] }
    };

    function handlePurposeChange() {
      const p = document.getElementById('purpose').value;
      resetFields();
      if (p) {
        updatePurposeUI(p);
      }
    }

    function resetFields() {
      const ids = ['field1', 'field2', 'field3', 'costReqDate', 'bomReqDate', 'note', 'productType'];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.value = ""; el.required = false; }
      });
      document.getElementById('subjectPreview').innerText = "å°šæœªè¼¸å…¥å®Œæ•´è³‡è¨Š...";
      document.getElementById('subject-preview-container').classList.add('hidden');
      document.getElementById('note-area').classList.add('hidden');
      ['cost-date-container', 'bom-date-container', 'field1-container', 'field2-container', 'field3-container', 'product-type-container'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
    }

    function updatePurposeUI(p) {
      const c = config[p];
      document.getElementById('mainReceiver').value = c.to;
      document.getElementById('receiver').value = c.cc;
      document.getElementById('subject-preview-container').classList.remove('hidden');
      document.getElementById('note-area').classList.remove('hidden');
      
      const isCost = p.includes("æˆæœ¬");
      const isDemand = (p === "è«‹å ±åƒ¹" || p === "å»ºç³»çµ±");
      const isFile = (p === "æ–‡ä»¶å›æ”¶");

      document.getElementById('cost-date-container').classList.remove('hidden');
      document.getElementById('costReqDate').required = true;
      document.getElementById('label-cost-date').innerText = (isDemand || isFile) ? "éœ€æ±‚æ—¥æœŸ" : p + "é è¨ˆå®Œæˆæ—¥";
      
      if (isCost) { 
        document.getElementById('bom-date-container').classList.remove('hidden'); 
        document.getElementById('bomReqDate').required = true; 
      }
      if (isCost || isFile) { 
        document.getElementById('product-type-container').classList.remove('hidden'); 
        document.getElementById('productType').required = true; 
      }

      c.fields.forEach((name, index) => {
        const i = index + 1;
        const el = document.getElementById('field' + i);
        const container = document.getElementById('field' + i + '-container');
        if (name) { 
          document.getElementById('label-field' + i).innerText = name + " *"; 
          el.required = true; 
          container.classList.remove('hidden'); 
        }
      });
      updateSubjectPreview();
    }

    function updateSubjectPreview() {
      const p = document.getElementById('purpose').value;
      if (!p || !config[p]) return;
      const f1 = document.getElementById('field1').value || "[å®¢æˆ¶]";
      const f2 = document.getElementById('field2').value || "[æ–™è™Ÿ]";
      const date = document.getElementById('costReqDate').value || "[æ—¥æœŸ]";
      const tag = config[p].tag;
      const type = document.getElementById('productType').value || "[é¡å‹]";
      
      let mainText = "";
      if (p === "è«‹å ±åƒ¹" || p === "å»ºç³»çµ±") { mainText = `${f1}, ${f2}, ${date}`; } 
      else if (p.includes("æˆæœ¬") || p === "æ–‡ä»¶å›æ”¶") { mainText = `${f2}, ${date}, ${type}`; }
      
      document.getElementById('subjectPreview').innerText = tag + mainText;
    }

    function formatDate(s) { if (!s) return ""; const d = new Date(s); return isNaN(d.getTime()) ? s : `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`; }

    function closeModal() { document.getElementById('mockModal').style.display = 'none'; }

    document.getElementById('appForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const p = document.getElementById('purpose').value;
      const formData = {
        fromUser: document.getElementById('fromUser').value,
        purpose: p,
        field1: document.getElementById('field1').value,
        field2: document.getElementById('field2').value,
        field3: document.getElementById('field3').value,
        costReqDate: formatDate(document.getElementById('costReqDate').value),
        bomReqDate: formatDate(document.getElementById('bomReqDate').value),
        note: document.getElementById('note').value.trim(),
        productType: document.getElementById('productType').value
      };
      
      const subject = document.getElementById('subjectPreview').innerText;
      const noteLine = formData.note ? `\r\nå‚™è¨»ï¼š${formData.note}\r\n` : "";
      const assistantLine = `\r\nä»»å‹™åŠ©æ‰‹é é¢ï¼š\r\n${appLink}\r\n`;
      
      let body = "";
      if (p === "è«‹å ±åƒ¹") {
        body = `Hi Lucy\r\n\r\nè«‹å”åŠ©å ±åƒ¹\r\n\r\nå®¢æˆ¶ä»£ç¢¼: ${formData.field1}\r\nå®¢æˆ¶æ–™è™Ÿ: ${formData.field2}\r\n\r\nè³‡æ–™è·¯å¾‘:\r\n<${formData.field3}>\r\n\r\néœ€æ±‚æ™‚é–“: ${formData.costReqDate}\r\n${noteLine}${assistantLine}\r\næ„Ÿè¬`;
      } else if (p === "å»ºç³»çµ±") {
        body = `Hi Lucy\r\n\r\nè«‹å”åŠ©å»ºç³»çµ±\r\nä¿¡é‚¦æ–™è™Ÿï¼š${formData.field2}\r\n\r\nå®¢æˆ¶ä»£ç¢¼ï¼š${formData.field1}\r\n\r\nè³‡æ–™è·¯å¾‘ï¼š\r\n<${formData.field3}>\r\n\r\néœ€æ±‚æ—¥æœŸï¼š${formData.costReqDate}\r\n${noteLine}${assistantLine}\r\næ„Ÿè¬`;
      } else if (p === "æ–‡ä»¶å›æ”¶") {
        body = `Hi Erin, Ray\r\n\r\nä¿¡é‚¦æ–™è™Ÿ: ${formData.field2}\r\nç”¢å“é¡å‹: ${formData.productType}\r\néœ€æ±‚æ™‚é–“: ${formData.costReqDate}\r\n${noteLine}FAIRå·²ç™¼å‡º, è«‹å”åŠ©å›æ”¶ç´™æœ¬åœ–BOMã€‚\r\n${assistantLine}\r\næ„Ÿè¬`;
      } else if (p.includes("æˆæœ¬")) {
        body = `Hi All\r\n\r\nå®¢æˆ¶ä»£ç¢¼ï¼š${formData.field1}\r\nä¿¡é‚¦æ–™è™Ÿï¼š${formData.field2}\r\nç”¢å“é¡å‹ï¼š${formData.productType}\r\n\r\nè³‡æ–™è·¯å¾‘ï¼š\r\n<${formData.field3}>\r\n\r\nHi Lucy\r\nè«‹å”åŠ©å»ºç«‹${p}ï¼Œ\r\né è¨ˆå®Œæˆæ—¥ï¼š${formData.costReqDate}\r\n\r\nHi Erin\r\nè«‹å”åŠ©åœ–BOMç”¢å‡º\r\né è¨ˆå®Œæˆæ—¥ï¼š${formData.bomReqDate}\r\n${noteLine}${assistantLine}\r\næ„Ÿè¬`;
      }

      // æ¨¡æ“¬é¡¯ç¤ºè³‡è¨Š
      document.getElementById('mailSummary').innerText = `To: ${document.getElementById('mainReceiver').value}\nSubject: ${subject}\n\n${body}`;
      document.getElementById('mockModal').style.display = 'flex';
      
      // é€™è£¡åŸæœ¬æœƒåŸ·è¡Œ window.location.href = "mailto:..."
      console.log("Mailto Link Generated!");
    });
  </script>
</body>
</html>
